import pandas as pd
from shapely.geometry import Point
from shapely.wkt import loads
import geopandas as gpd

data_mediciones = pd.read_csv('acumar_mediciones.csv')
data_limites_subcuencas = gpd.read_file('LIMITES_SUBCUENCAS_.csv')
data_limites_cuencas = gpd.read_file('TRAMOS_DE_CUENCA.csv')

data_limites_subcuencas['geometry_subcuencas'] = data_limites_subcuencas['wkb_geometry'].apply(lambda x: loads(x))
data_limites_cuencas['geometry_cuencas'] = data_limites_cuencas['wkb_geometry'].apply(lambda x: loads(x))

data_mediciones['geometry'] = data_mediciones.apply(lambda row: Point(float(row['Longitud'].replace(',', '.')), float(row['Latitud'].replace(',', '.'))), axis=1)
data_mediciones = gpd.GeoDataFrame(data_mediciones, geometry='geometry')

geo_df_subcuencas = gpd.GeoDataFrame(data_limites_subcuencas, geometry=data_limites_subcuencas['geometry_subcuencas'])
geo_df_cuencas = gpd.GeoDataFrame(data_limites_cuencas, geometry=data_limites_cuencas['geometry_cuencas'])

print(type(data_mediciones))
print(type(geo_df_cuencas[['OBJECTID', 'JURISDIC', 'geometry_cuencas']]))
#data_mediciones = gpd.sjoin(data_mediciones, geo_df_subcuencas[['ID', 'Nombre_sub', 'geometry_subcuencas']], how='left', predicate='within')
#data_mediciones = gpd.sjoin(data_mediciones, geo_df_cuencas[['OBJECTID', 'JURISDIC', 'geometry_cuencas']], how='left', predicate='within')

#data_mediciones.drop(columns=['index_right'], inplace=True)


#print(data_mediciones)